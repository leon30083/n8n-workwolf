# 规则变更记录（依据“经验1115-1”）

- 日期：2025-11-15
- 关联经验：`/用户专用文件夹-AI勿动/经验1115-1` 第 1–5 条
- 变更对象：`.trae/rules/project_rules.md`

## 变更动机
- 落实 MVP 优先、小步快跑与单一改动的工程节奏
- 保证新增功能不破坏既有核心（尤其轮询闭环）
- 同功能多分支要先单分支验证再镜像扩展

## 调整条目（新增/修订）
- 单一功能最小增量（新增）
  - 一次改动只做一个功能模块的最小变更；如需覆盖多分支，仅限同一功能的“镜像改动”，并且必须先在一个分支验证通过，再同步到其他分支。
- 核心业务保护（新增）
  - 不得为“通过校验”或“样式升级”而改动核心业务结构（例如轮询闭环、触发链路、鉴权流）；新增功能只能在成功分支末尾串接，严禁影响既有模块的运行逻辑。
- 分支独立验证（新增）
  - 同一功能存在多分支（如 Text/Image）时，两个分支都要分别验证且互不干扰；任何一支的失败不得阻断另一支的正常执行。
- 质量类改动独立批次（修订）
  - “版本与容错”条下补充：typeVersion 升级、onError/retry/timeout、响应头开启等属于质量类改动，必须在独立迭代中执行，不与业务功能同批次，且不得改变核心逻辑。
- 合法轮询闭环豁免（新增）
  - “校验 Profile 与自动清理”条下补充：当校验报告因合法的轮询闭环（Wait→Check→Normalize→IF→回 Wait）产生的 `cycle` 错误时，按业务预期结构记录并采用说明性豁免或在测试环境降级 Profile 验证；禁止为通过校验而拆改回路。

## 未变更条目（保持不变）
- 变更铁律“四步闭环”：看全→最小增量→校验→端到端测试
- 参数覆盖保护与鉴权规范
- 聚鑫 API 严格对齐与 nodeType 前缀规范
- 表达式与工具使用规范、代理与安全、用例与常见问题

## 影响范围
- 对项目运行方式无破坏性影响；仅在规范层明确约束，避免未来改动破坏核心逻辑
- 与现有工作流兼容；无需迁移代码

## 建议
- 将“质量类改动”（版本、错误处理、重试、超时）按独立任务执行
- 对轮询型工作流默认使用 runtime 校验；strict 如仅因闭环报错，采用说明性豁免